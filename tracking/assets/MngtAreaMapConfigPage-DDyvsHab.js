import{j as r,n as re,r as t,o as P}from"./index-Df67LvnZ.js";import{f as te,o as se,q as b,O as le}from"./api-D0CI0FXg.js";import{M as f,B as ne}from"./DefaultLayout-ChSX5Qog.js";import{r as E,u as oe,M as ie}from"./index.esm-DQwAVOjC.js";import{u as de,C as ce}from"./useMapCanvasModel-BkZNw9zP.js";import{i as k}from"./styled-GyNyOFDO.js";import{b as h,d as p,a as y}from"./index.es-GiY7mkae.js";import{A as x,T as A,I as ue}from"./TextField-CGQe4LUV.js";import{C as fe,a as pe,b as me,c as ge,d as be}from"./CModalTitle-RwIWiDqx.js";import"./Box-ClPNTXLH.js";var C={},he=k;Object.defineProperty(C,"__esModule",{value:!0});var R=C.default=void 0,xe=he(E()),Ae=r;R=C.default=(0,xe.default)((0,Ae.jsx)("path",{d:"M3 10h11v2H3zm0-2h11V6H3zm0 8h7v-2H3zm15.01-3.13.71-.71c.39-.39 1.02-.39 1.41 0l.71.71c.39.39.39 1.02 0 1.41l-.71.71zm-.71.71-5.3 5.3V21h2.12l5.3-5.3z"}),"EditNote");var D={},Ce=k;Object.defineProperty(D,"__esModule",{value:!0});var z=D.default=void 0,De=Ce(E()),Ie=r;z=D.default=(0,De.default)((0,Ie.jsx)("path",{d:"M4 20h16v2H4zM4 2h16v2H4zm9 7h3l-4-4-4 4h3v6H8l4 4 4-4h-3z"}),"Expand");const _e=({setToast:i})=>{const d=re();t.useState([]),t.useState([]);const I=P(e=>e.areaList),[L,_]=t.useState([]),[Se,N]=t.useState(0),[S,c]=t.useState(!1),[m,O]=t.useState({imageSource:"./test1.png",data:[]}),J=P(e=>e.redirectParams),[T,B]=t.useState([]),[q,H]=t.useState([]),[n,$]=t.useState(null),[o,v]=t.useState(null),[l,g]=t.useState(null),{background:F,elements:U,loadBackground:G,saveData:K,loadDataSource:V}=de();t.useEffect(()=>{te("",-100,1,1e4).then(e=>{e.error?i(f(!0,"Error",e.error.response.data.message)):_(e.data.data)}),d({type:"set",areaList:[]})},[]),t.useEffect(()=>{n&&se("",0,n.ParkingID,-100,1,1e4).then(e=>{B(e.data.data.filter(a=>!a.IsParent&&a.ParkingID===n.ParkingID))})},[n]),t.useEffect(()=>{o&&b(o.AreaID).then(e=>{H(e.data)})},[o]),t.useEffect(()=>{l&&(b(l.AreaID).then(e=>{d({type:"set",areaList:e.data})}),d({type:"set",redirectParams:{...J,[ne]:{department:l,area:o,parking:n}}}))},[l]),t.useEffect(()=>{V(m.data)},[m]);const Y=e=>{e.preventDefault(),K(function(a){var s=localStorage.getItem("user");if(!s)return navigate("/pages/login");var j=JSON.parse(s).data;if(!a){i(f(!0,"Error","An Error has occurred while saving"));return}var ee=JSON.parse(a).data,M=ee.find(u=>u.IsCurrent);le(j.UserID,j.UserName,M.id,M.JsonRectangle).then(u=>{u.error?i(f(!0,"Error",u.error.response.data.message)):(i(f(!1,"Success","Map Updated")),b(l.AreaID).then(ae=>{d({type:"set",areaList:ae.data})}),c(!1))})})},Q=(e,a)=>{e.preventDefault(),c(!S),W(a.original.AreaID)},W=e=>{const a=I.filter(s=>s.AreaID==e||s.JsonAddress!=null&&s.JsonAddress!="").map(s=>({id:s.AreaID,IsTemplate:!1,NumberEquipment:s.NumberPosition,Color:s.AreaID==e?"#ffff66":"#ccc",IsCurrent:s.AreaID==e,JsonRectangle:X(s.JsonAddress)?"[[100,50],[200,50],[200,150],[100,150]]":s.JsonAddress,IsEdit:s.AreaID==e}));O({...m,data:a})},X=e=>!e||e.length===0,Z=t.useMemo(()=>[{accessorKey:"AreaCode",header:"AreaCode"},{accessorKey:"AreaName",header:"AreaName"},{accessorKey:"JsonAddress",header:"JsonAddress"}],[]),w=oe({columns:Z,data:I,enableGlobalFilter:!1,enableColumnActions:!1,enableColumnFilters:!1,enableRowNumbers:!0,enableFullScreenToggle:!1,visibleInShowHideMenu:!1,enableDensityToggle:!1,enableRowActions:!0,enableHiding:!1,getSubRows:e=>e.subRows,muiTablePaperProps:{elevation:0,sx:{borderRadius:"1"}},initialState:{density:"compact"},layoutMode:"grid",muiTableBodyProps:{sx:{"& tr:nth-of-type(odd) > td":{backgroundColor:"#f5f5f5"}}},displayColumnDefOptions:{"mrt-row-actions":{size:70,grow:!1}},renderRowActions:({row:e,table:a})=>e.original.IsParent!=null?[r.jsx(ue,{"aria-label":"delete",size:"medium",onClick:()=>{Q(event,e)},children:r.jsx(R,{fontSize:"inherit"})},e.original.AreaID)]:[r.jsx(z,{color:"primary",fontSize:"inherit"})]});return r.jsxs(h,{fluid:!0,children:[r.jsxs(h,{style:{background:"#fff",padding:12,borderRadius:4},className:"row g-3",fluid:!0,children:[r.jsx(p,{xs:4,children:r.jsx(x,{xs:4,size:"small",disablePortal:!0,id:"cbParking",onChange:(e,a)=>{N(a==null?void 0:a.ParkingID),$(a),G({imageSrc:a==null?void 0:a.ImagePath}),v(null),g(null)},options:L,getOptionLabel:e=>`${e.ParkingName}`,isOptionEqualToValue:(e,a)=>(e==null?void 0:e.ParkingID)===(a==null?void 0:a.ParkingID),renderInput:e=>r.jsx(A,{...e,label:"Branch"})})}),r.jsx(p,{xs:4,children:r.jsx(x,{size:"small",disablePortal:!0,disableClearable:!0,id:"cbArea",value:o,onChange:(e,a)=>{v(a),g(null)},options:T,getOptionLabel:e=>`${e.AreaCode}`,isOptionEqualToValue:(e,a)=>(e==null?void 0:e.AreaID)===(a==null?void 0:a.AreaID),renderInput:e=>r.jsx(A,{...e,label:"Area"})})}),r.jsx(p,{xs:4,children:r.jsx(x,{size:"small",disablePortal:!0,disableClearable:!0,id:"cbDepartment",value:l,onChange:(e,a)=>{g(a)},options:q,getOptionLabel:e=>`${e.AreaCode}`,isOptionEqualToValue:(e,a)=>(e==null?void 0:e.AreaID)===(a==null?void 0:a.AreaID),renderInput:e=>r.jsx(A,{...e,label:"Department"})})})]}),r.jsx(h,{style:{background:"#fff",padding:12,borderRadius:4},className:"row g-3",fluid:!0,children:r.jsx(ie,{table:w})}),r.jsxs(fe,{fullscreen:!0,alignment:"center",scrollable:!0,visible:S,onClose:()=>c(!1),"aria-labelledby":"VerticallyCenteredScrollableExample2",children:[r.jsx(pe,{children:r.jsx(me,{id:"VerticallyCenteredScrollableExample2",children:"Map Config"})}),r.jsx(ge,{children:r.jsx(p,{children:r.jsx(ce,{elements:U,initialState:"SELECT",background:F})})}),r.jsxs(be,{children:[r.jsx(y,{color:"secondary",onClick:()=>c(!1),children:"Close"}),r.jsx(y,{color:"primary",onClick:Y,children:"Save changes"})]})]})]})};export{_e as default};
