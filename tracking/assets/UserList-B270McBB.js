import{n as G,o as y,l as X,r as n,j as s}from"./index-Df67LvnZ.js";import{Z}from"./index-Dntgz-Jr.js";import{x as V,y as S,z as q,g as Q,A as W}from"./api-D0CI0FXg.js";import{u as Y,a as D,d as w,M as ee}from"./index.esm-DQwAVOjC.js";import{B as se,d as ae}from"./ButtonOfList-CQegefUu.js";import{U as te,D as le,h as m,M as g}from"./DefaultLayout-ChSX5Qog.js";import{F as k,f as E,a as N}from"./index-C_Aa_IVI.js";import{d,b as v,a as A}from"./index.es-GiY7mkae.js";import{C as c}from"./CFormCheck-Bqq75Q6c.js";import{C as re,a as oe,b as de,c as ie,d as ne}from"./CModalTitle-RwIWiDqx.js";import"./styled-GyNyOFDO.js";import"./TextField-CGQe4LUV.js";import"./Box-ClPNTXLH.js";import"./CFormLabel-U7mi1tVG.js";const we=({setToast:j})=>{const p=G(),C=y(e=>e.userList),u=X(),[K,h]=n.useState(!1),[R,b]=n.useState([]),[f,M]=n.useState([]),U=y(e=>e.permission),[l,F]=n.useState({IsView:0,IsUpdate:0,IsDelete:0,IsInsert:0});n.useEffect(()=>{V("",0,-100,-100,1e4).then(e=>{I(e),e.error||p({type:"set",userList:e.data.data})}),S().then(e=>{I(e),e.error||b(e.data.data)})},[]),n.useEffect(()=>{F(U.find(e=>e.ModuleID===te.id))},[U]);const I=e=>{e.error&&u(le,{state:{isErrorMessage:!0,message:e.error.response.data.message}})},L=n.useMemo(()=>[{accessorKey:"FullName",header:"Full Name"},{accessorKey:"Email",header:"Email"},{accessorKey:"TypeUserID",header:"Is Administrator",Cell:({cell:e})=>s.jsxs(d,{children:[s.jsx(k,{icon:e.getValue()==0?E:N,style:e.getValue()==0?{color:"red"}:{color:"green"},size:"lg"}),s.jsx("span",{children:" "}),"Active"]})},{accessorKey:"StatusID",header:"Status",Cell:({cell:e})=>s.jsxs(d,{children:[s.jsx(k,{icon:e.getValue()==0?E:N,style:e.getValue()==0?{color:"red"}:{color:"green"},size:"lg"}),s.jsx("span",{children:" "}),e.getValue()==1?"Active":"Deactive"]})}],[]),_=n.useMemo(()=>[{accessorKey:"Name",header:"Module Name"},{accessorKey:"Description",header:"Description"},{accessorKey:"IsView",header:"View",Cell:({cell:e})=>s.jsx(d,{children:s.jsx(c,{id:"cbIsView",defaultChecked:e.getValue()!=0,onChange:()=>i(e)})})},{accessorKey:"IsInsert",header:"Insert",Cell:({cell:e})=>s.jsx(d,{children:s.jsx(c,{id:"cbIsView",defaultChecked:e.getValue()!=0,onChange:()=>i(e)})})},{accessorKey:"IsUpdate",header:"Update",Cell:({cell:e})=>s.jsx(d,{children:s.jsx(c,{id:"cbIsView",defaultChecked:e.getValue()!=0,onChange:()=>i(e)})})},{accessorKey:"IsDelete",header:"Delete",Cell:({cell:e})=>s.jsx(d,{children:s.jsx(c,{id:"cbIsView",defaultChecked:e.getValue()!=0,onChange:()=>i(e)})})}],[]),x=e=>{u(typeof e=="string"?"edit/0":`edit/${e.original.UserID}`)},T=e=>{var a=localStorage.getItem("user");if(a==null)return u("/pages/login");JSON.parse(a).data,e.original.UserID&&q(e.original.UserID).then(t=>{t.error?j(g(!0,"Error",t.error.response.data.message)):(V("",0,-100,-100,1e4).then(r=>{p({type:"set",userList:r.data.data})}),j(g(!1,"Success","User have been deleted")))})};Z({fieldSeparator:",",decimalSeparator:".",useKeysAsHeaders:!0});const O=e=>{e.original.UserID&&(Q(e.original.UserID).then(a=>{if(I(a),!a.error){let t=R.map(r=>{a.data.data.find(o=>o.ModuleID==r.ModuleID);let H=a.data.data.find(o=>o.ModuleID==r.ModuleID&&o.IsView==1)!=null?1:0,z=a.data.data.find(o=>o.ModuleID==r.ModuleID&&o.IsInsert==1)!=null?1:0,J=a.data.data.find(o=>o.ModuleID==r.ModuleID&&o.IsDelete==1)!=null?1:0,P=a.data.data.find(o=>o.ModuleID==r.ModuleID&&o.IsUpdate==1)!=null?1:0;return{UserID:e.original.UserID,ModuleID:r.ModuleID,Name:r.Name,Description:r.Description,IsView:H,IsInsert:z,IsDelete:J,IsUpdate:P}});M(t)}}),h(!0))},$=()=>{var e=localStorage.getItem("user");if(e==null)return u("/pages/login");var a=JSON.parse(e).data;a&&W(a.UserID,a.UserName,f).then(t=>{I(t),t.error||(j(g(!1,"Success","User have been updated")),S().then(r=>{I(r),r.error||b(r.data.data)}),h(!1))})},B=Y({columns:L,data:C,renderTopToolbarCustomActions:({table:e})=>s.jsx("div",{className:m(l==null?void 0:l.IsInsert),children:s.jsx(se,{text:"Insert",callback:()=>x("edit")})}),enableGlobalFilter:!1,createDisplayMode:"modal",positionCreatingRow:"bottom",enableRowActions:!((l==null?void 0:l.IsUpdate)===0&&(l==null?void 0:l.IsDelete)===0),enableColumnActions:!1,enableColumnFilters:!1,enableRowNumbers:!0,enableFullScreenToggle:!1,visibleInShowHideMenu:!1,enableDensityToggle:!1,initialState:{density:"compact"},enableHiding:!1,renderRowActionMenuItems:({closeMenu:e,row:a})=>[s.jsxs(D,{className:m(l==null?void 0:l.IsUpdate),onClick:t=>{x(a),e()},children:[s.jsx(w,{}),"Edit"]},0),a.original.UserID!=1?s.jsxs(D,{onClick:t=>{t.preventDefault(),O(a),e()},children:[s.jsx(w,{}),"Edit Role"]},1):s.jsx("span",{},1),s.jsxs(D,{className:m(l==null?void 0:l.IsDelete),onClick:()=>{T(a),e()},children:[s.jsx(ae,{}),"Delete"]},2)]}),i=(e,a)=>{M(f.map(t=>(t.ModuleID===e.ModuleID&&(t[a]==0?t[a]=1:t[a]=0),t)))};return s.jsxs(d,{children:[C.length==0?s.jsx(v,{children:" No Data "}):s.jsx(ee,{table:B}),s.jsxs(re,{size:"xl",alignment:"center",scrollable:!0,visible:K,onClose:()=>h(!1),"aria-labelledby":"VerticallyCenteredScrollableExample2",children:[s.jsx(oe,{children:s.jsx(de,{id:"VerticallyCenteredScrollableExample2",children:"User role"})}),s.jsx(ie,{children:s.jsx(d,{children:f.length==0?s.jsx(v,{children:" No Data "}):s.jsxs("table",{className:"table",children:[s.jsx("thead",{children:s.jsx("tr",{children:_.map((e,a)=>s.jsx("th",{scope:"col",children:e.header},a))})}),s.jsx("tbody",{children:f.map(e=>s.jsxs("tr",{children:[s.jsx("td",{children:e.Name}),s.jsx("td",{children:e.Description}),s.jsx("td",{children:s.jsx(d,{children:s.jsx(c,{id:`cbIsView_${e.ModuleID}`,defaultChecked:e.IsView==1,onChange:()=>i(e,"IsView")})})}),s.jsx("td",{children:s.jsx(d,{children:s.jsx(c,{id:`cbIsInsert_${e.ModuleID}`,defaultChecked:e.IsInsert==1,onChange:()=>i(e,"IsInsert")})})}),s.jsx("td",{children:s.jsx(d,{children:s.jsx(c,{id:`cbIsUpdate_${e.ModuleID}`,defaultChecked:e.IsUpdate==1,onChange:()=>i(e,"IsUpdate")})})}),s.jsx("td",{children:s.jsx(d,{children:s.jsx(c,{id:`cbIsDelete_${e.ModuleID}`,defaultChecked:e.IsDelete==1,onChange:()=>i(e,"IsDelete")})})})]},e.ModuleID))})]})})}),s.jsxs(ne,{children:[s.jsx(A,{color:"secondary",onClick:()=>h(!1),children:"Close"}),s.jsx(A,{color:"primary",onClick:()=>$(),children:"Save changes"})]})]})]})};export{we as default};
