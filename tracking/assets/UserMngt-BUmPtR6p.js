import{z as q,l as L,o as k,r as h,j as e}from"./index-Df67LvnZ.js";import{b as W,t as _,u as B,v as J,w as V}from"./api-D0CI0FXg.js";import{U as G,D as v,g as D,a as b,b as H,c as j,d as I,e as K,f as U,M as c,L as F}from"./DefaultLayout-ChSX5Qog.js";import{b as E,d as o,a as w}from"./index.es-GiY7mkae.js";import{C as Y}from"./CForm-BlQPlA_m.js";import{C as t}from"./CFormLabel-U7mi1tVG.js";import{C as n}from"./CFormInput-DweMMv1W.js";import{C as P}from"./CFormSelect-DYU2t1Q-.js";import{C as z,a as Q,b as X,c as Z,d as $}from"./CModalTitle-RwIWiDqx.js";import"./CFormControlWrapper-C6kxU_lF.js";const me=({setToast:m})=>{const{id:x}=q(),d=L(),S=k(r=>r.permission),[O,A]=h.useState([]),[M,C]=h.useState(!1),[s,y]=h.useState({UserID:0,FullName:"",IDNumber:"",Email:"",PhoneOffice:"",Phone:"",Address:"",PostCode:"",City:"",TypeUserID:"",IsAllowToMoveExpiredRecord:"",StatusID:"",CountryID:"",UserName:"",IsEdit:!1,Password:"",ConfirmPassword:"",OldPassword:""});h.useEffect(()=>{var r=S.find(l=>l.ModuleID===G.id);if(x&&x!=0)if((r==null?void 0:r.IsUpdate)===0){d(v,D(!0,"You aren't allowed to do this action"));return}else W(x).then(l=>{if(l.error){d(b,{isErrorMessage:!0,message:"Some things went wrong. Try again later."});return}else l.data.data.IsEdit=!0,l.data.data.OldPassword="",l.data.data.Password="",l.data.data.ConfirmPassword="",y(l.data.data)}),g();else if(r.IsInsert===0){d(v,D(!0,"You aren't allowed to do this action"));return}else g()},[]);const g=()=>{_("",1,0,1e4).then(r=>{A(r.data.data.data)})},a=r=>{const{name:l,value:i}=r.target;y({...s,[l]:i})},T=r=>{if(r.preventDefault(),formPassword.Password!==formPassword.ConfirmPassword){m(c(!0,"Error","Confirm password is incorrect"));return}var l=localStorage.getItem("user");if(l==null)return d(F);JSON.parse(l).data,s.IsEdit||B(s.UserID,s.OldPassword,s.Password).then(i=>{i.error?m(c(!0,"Error",i.error.response.data.message)):m(c(!1,"Success","Password has been updated"))})},R=r=>{const l=r.currentTarget;r.preventDefault(),l.checkValidity()===!1&&r.stopPropagation();var i=localStorage.getItem("user");if(i==null)return d(F);var p=JSON.parse(i).data;if(s.IsEdit)J(p.UserID,p.UserName,"",s.TypeUserID,s.UserID,"",s.FullName,s.Email,s.Phone,s.StatusID,0,0,s.CountryID,s.PostCode,s.City,s.Address,s.PhoneOffice,s.UserID).then(u=>{if(u.error)m(c(!0,"Error",u.error.response.data.message));else{d(b,{state:{isErrorMessage:!1,message:"User has been updated"}});return}});else{if(s.Password!==s.ConfirmPassword){m(c(!0,"Error","Confirm password is incorrect"));return}V(p.UserID,p.UserName,"",s.TypeUserID,s.UserName,s.Password,s.FullName,s.Email,s.Phone,s.StatusID,0,0,s.CountryID,s.PostCode,s.City,s.Address,s.PhoneOffice,s.UserID).then(u=>{if(u.error)m(c(!0,"Error",u.error.response.data.message));else{d(b,{isErrorMessage:!1,message:"User has been created"});return}})}},[f,N]=h.useState(1);return e.jsxs("div",{children:[e.jsx(E,{children:e.jsx("h3",{children:"User's Profile"})}),e.jsxs(E,{style:{background:"#fff",padding:12,borderRadius:4,marginBottom:12},children:[e.jsxs(Y,{className:"row g-3",onSubmit:R,children:[e.jsxs(o,{md:6,children:[e.jsxs(t,{htmlFor:"UIDInput",className:"col-form-label fw-bolder",children:["UID",e.jsx("span",{style:{color:"red",fontWeight:"bold"},children:"*"})]}),e.jsx(n,{type:"text",id:"UIDInput",value:s.UserID,name:"UserID",onChange:a,disabled:!0})]}),e.jsxs(o,{md:6,children:[e.jsxs(t,{htmlFor:"fullNameInput",className:"col-form-label fw-bolder",children:["Full Name",e.jsx("span",{style:{color:"red",fontWeight:"bold"},children:"*"})]}),e.jsx(n,{type:"text",id:"fullNameInput",name:"FullName",required:!0,value:s.FullName,onChange:a})]}),e.jsxs(o,{xs:6,children:[e.jsx(t,{htmlFor:"emailAddressInput",className:"col-form-label fw-bolder",children:"Email Address"}),e.jsx(n,{type:"email",id:"emailAddressInput",name:"Email",value:s.Email,onChange:a})]}),e.jsxs(o,{md:6,children:[e.jsxs(t,{htmlFor:"isAdminInput",className:"col-form-label fw-bolder",children:["Is Administrator",e.jsx("span",{style:{color:"red",fontWeight:"bold"},children:"*"})]}),e.jsx(P,{type:"text",id:"isAdminInput",name:"TypeUserID",value:s.TypeUserID,options:[{label:"True",value:1},{label:"False",value:0}],onChange:a,required:!0})]}),e.jsxs(o,{md:6,children:[e.jsxs(t,{htmlFor:"statusInput",className:"col-form-label fw-bolder",children:["Status",e.jsx("span",{style:{color:"red",fontWeight:"bold"},children:"*"})]}),e.jsx(P,{type:"text",id:"statusInput",name:"StatusID",onChange:a,value:s.StatusID,options:[{label:"True",value:1},{label:"False",value:0}],required:!0})]}),e.jsxs(H,{variant:"tabs",role:"tablist",children:[e.jsx(j,{children:e.jsx(I,{"data-tab":"contact-information-tab",className:"fw-bolder",active:f===1,role:"button",onClick:()=>N(1),children:"Contact Information"})}),s.IsEdit?e.jsx(j,{children:e.jsx(I,{"data-tab":"ChangePassword",onClick:r=>{r.preventDefault,C(!0)},className:"fw-bolder",role:"button",children:"Change Password"})}):e.jsx(j,{children:e.jsx(I,{"data-tab":"accountTab",className:"fw-bolder",role:"button",active:f===2,onClick:()=>N(2),children:"Account"})})]}),e.jsxs(K,{children:[e.jsx(U,{role:"tabpanel","aria-labelledby":"contact-information-tab",visible:f===1,children:e.jsxs("div",{className:"row g-3 d-flex",children:[e.jsxs(o,{md:6,children:[e.jsx(t,{htmlFor:"officePhoneInput",className:"col-form-label fw-bolder",children:"Office Phone"}),e.jsx(n,{type:"text",id:"officePhoneInput",value:s.PhoneOffice,onChange:a,name:"PhoneOffice"})]}),e.jsxs(o,{md:6,children:[e.jsx(t,{htmlFor:"PhoneInput",className:"col-form-label fw-bolder",children:"Mobile Phone"}),e.jsx(n,{type:"number",id:"PhoneInput",value:s.Phone,onChange:a,name:"Phone"})]}),e.jsxs(o,{md:6,children:[e.jsx(t,{htmlFor:"addressInput",className:"col-form-label fw-bolder",children:"Address"}),e.jsx(n,{type:"text",id:"addressInput",value:s.Address,onChange:a,name:"Address"})]}),e.jsxs(o,{md:6,children:[e.jsx(t,{htmlFor:"postalCodeInput",className:"col-form-label fw-bolder",children:"Postal Code"}),e.jsx(n,{type:"text",id:"postalCodeInput",value:s.PostCode,onChange:a,name:"PostCode"})]}),e.jsxs(o,{md:6,children:[e.jsx(t,{htmlFor:"cityInput",className:"col-form-label fw-bolder",children:"City"}),e.jsx(n,{type:"text",id:"cityInput",value:s.City,onChange:a,name:"City"})]}),e.jsxs(o,{md:6,children:[e.jsxs(t,{htmlFor:"countryInput",className:"col-form-label fw-bolder",children:["Country ",e.jsx("span",{style:{color:"red",fontWeight:"bold"},children:"*"})]}),e.jsx(P,{type:"text",id:"countryInput",name:"CountryID",onChange:a,value:s.CountryID,options:[...O.map(r=>({label:r.CountryName,value:r.CountryID}))],required:!0})]})]})}),s.IsEdit?e.jsx(e.Fragment,{}):e.jsxs(U,{role:"tabpanel","aria-labelledby":"accountTab",visible:f===2,children:[e.jsxs(o,{md:12,children:[e.jsxs(t,{htmlFor:"userNameInput",className:"col-form-label fw-bolder",children:["User Name",e.jsx("span",{style:{color:"red",fontWeight:"bold"},children:"*"})]}),e.jsx(n,{type:"text",id:"userNameInput",value:s.UserName,onChange:a,name:"UserName",required:!0})]}),e.jsxs(o,{md:12,children:[e.jsx(t,{htmlFor:"passwordInput",className:"col-form-label fw-bolder",children:"Password"}),e.jsx(n,{type:"password",id:"passwordInput",value:s.Password,onChange:a,name:"Password",required:!0})]}),e.jsxs(o,{md:12,children:[e.jsx(t,{htmlFor:"confirmPasswordInput",className:"col-form-label fw-bolder",children:"Confirm-Password"}),e.jsx(n,{type:"password",id:"confirmPasswordInput",value:s.ConfirmPassword,onChange:a,name:"ConfirmPassword",required:!0})]})]})]}),e.jsx("div",{className:"d-flex justify-content-center",children:e.jsx(w,{style:{width:"fit-content",marginTop:"30px"},color:"primary",type:"submit",children:s.IsEdit?"Update profile":"Create user"})})]}),e.jsxs(z,{alignment:"center",scrollable:!0,visible:M,onClose:()=>C(!1),"aria-labelledby":"VerticallyCenteredScrollableExample2",children:[e.jsx(Q,{children:e.jsx(X,{id:"VerticallyCenteredScrollableExample2",children:"Modal title"})}),e.jsxs(Z,{children:[e.jsxs(o,{md:12,children:[e.jsx(t,{htmlFor:"OldPasswordInput",className:"col-form-label fw-bolder",children:"Old Password"}),e.jsx(n,{type:"password",id:"OldPasswordInput",value:s.OldPassword,onChange:a,name:"OldPassword",required:!0})]}),e.jsxs(o,{md:12,children:[e.jsx(t,{htmlFor:"passwordInput",className:"col-form-label fw-bolder",children:"Password"}),e.jsx(n,{type:"password",id:"passwordInput",value:s.Password,onChange:a,name:"Password",required:!0})]}),e.jsxs(o,{md:12,children:[e.jsx(t,{htmlFor:"ConfirmPasswordInput",className:"col-form-label fw-bolder",children:"Confirm-Password"}),e.jsx(n,{type:"password",id:"ConfirmPasswordInput",value:s.ConfirmPassword,onChange:a,name:"ConfirmPassword",required:!0})]})]}),e.jsxs($,{children:[e.jsx(w,{color:"secondary",onClick:()=>C(!1),children:"Close"}),e.jsx(w,{color:"primary",onClick:T,children:"Save changes"})]})]})]})]})};export{me as default};
