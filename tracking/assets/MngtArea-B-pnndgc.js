import{z as W,l as J,r as i,j as a}from"./index-DVdUffN9.js";import{e as y,q as j,s as _,a as $,t as w}from"./api-BVwJHRoD.js";import{A as P,L as G,M as z}from"./DefaultLayout-CfPVXb2h.js";import{b as N,a as H}from"./index.es-B3rfzgWZ.js";import{C as K}from"./CForm-Xve7Slsh.js";import{C as n}from"./CCol-CkNqnnbR.js";import{C as l}from"./CFormLabel-DkOTcXBr.js";import{C as c}from"./CFormInput-Um-rMPli.js";import{A as C,T as v}from"./TextField-CVwMZIf8.js";import{C as S}from"./CFormSelect-BcylGtpm.js";import"./cil-user-Ddrdy7PS.js";import"./CFormControlWrapper-DwzJvsqv.js";const le=({setToast:k})=>{const{areaid:p}=W(),I=J(),[T,F]=i.useState([]),[B,E]=i.useState([]),[L,R]=i.useState([]),[q,g]=i.useState([]),[t,f]=i.useState({AreaID:0,IsParent:void 0,ParkingID:void 0,ParkingObj:void 0,BayTypeID:void 0,AreaCode:"",AreaName:"",JsonAddress:"",NumberPosition:"",StatusID:void 0,Description:""}),[O,x]=i.useState(null),[M,b]=i.useState(null);i.useEffect(()=>{y("",1,0,1e4).then(e=>{m(e),F(e.data.data)}),j("",null,null,1,1,1e4).then(e=>{m(e);let r=A(e.data.data).filter(s=>s.AreaID!==t.AreaID);console.log(r),E(r)}),_().then(e=>{m(e),R(e.data.data)}),p&&p!=0&&$(p).then(e=>{m(e);let r=e.data.data;r.IsEdit=!0,f(r),y("",1,0,1e4).then(s=>{let d=s.data.data;x(d.filter(u=>u.ParkingID==r.ParkingID)[0]),j("",null,r.ParkingID,1,1,1e4).then(u=>{m(u);let D=A(u.data.data).filter(h=>h.AreaID!==t.AreaID);g(D),r.IsParent!=null&&b(D.filter(h=>h.AreaID==r.IsParent)[0])})})})},[]);function A(e){return e.reduce((r,s)=>(console.log(s.subRows),r=r.concat(s),Array.isArray(s.subRows)&&s.subRows.length>0&&(r=r.concat(s.subRows)),r),[])}const m=e=>{if(e.error){I(P,{isErrorMessage:!0,message:"Some things went wrong. Try again later."});return}},o=e=>{const{name:r,value:s}=e.target;let d=s;s==-1&&(d=void 0),f({...t,[r]:d})},U=e=>{const r=e.currentTarget;e.preventDefault(),r.checkValidity()===!1&&e.stopPropagation();var s=localStorage.getItem("user");if(s==null)return I(G);var d=JSON.parse(s).data;w(d.UserID,d.UserName,t.AreaID,t.IsParent,t.ParkingID,t.BayTypeID,t.AreaCode,t.AreaName,t.NumberPosition,t.IsTemplate,t.StatusID,t.Description).then(u=>{if(u.error)k(z(!0,"Error",u.error.response.data.message));else{I(P,{state:{isErrorMessage:!1,message:"Area has been updated"}});return}})};return a.jsxs("div",{children:[a.jsx(N,{children:a.jsx("h3",{children:"Area List"})}),a.jsx(N,{style:{background:"#fff",padding:12,borderRadius:4,marginBottom:12},children:a.jsxs(K,{className:"row g-3",onSubmit:U,children:[t.AreaID==0?a.jsx("span",{}):a.jsxs(n,{md:6,children:[a.jsxs(l,{htmlFor:"AreaIDInput",className:"col-form-label fw-bolder",children:["AreaID",a.jsx("span",{style:{color:"red",fontWeight:"bold"},children:"*"})]}),a.jsx(c,{type:"text",id:"AreaIDInput",value:t.AreaID,name:"AreaID",onChange:o,disabled:!0})]}),a.jsxs(n,{xs:6,children:[a.jsx(l,{htmlFor:"ParkingIDInput",className:"col-form-label fw-bolder",children:"Parking Slot"}),a.jsx(C,{sx:{"& .MuiOutlinedInput-root":{padding:"0px!important"}},required:!0,className:"mb-3",disablePortal:!0,id:"ParkingID",value:O,onChange:(e,r)=>{o({target:{value:r==null?void 0:r.ParkingID,name:"ParkingID"}}),g(B.filter(s=>s.ParkingID===(r==null?void 0:r.ParkingID))),x(r)},options:T,getOptionLabel:e=>`${e==null?void 0:e.ParkingName}`,isOptionEqualToValue:(e,r)=>e==r,renderInput:e=>a.jsx(v,{...e})})]}),a.jsxs(n,{xs:6,children:[a.jsx(l,{htmlFor:"IsParentInput",className:"col-form-label fw-bolder",children:"Parent Area"}),a.jsx(C,{sx:{"& .MuiOutlinedInput-root":{padding:"0px!important"}},className:"mb-3",disablePortal:!0,id:"IsParent",value:M,onChange:(e,r)=>{o({target:{value:r==null?void 0:r.AreaID,name:"IsParent"}}),b(r)},options:q,getOptionLabel:e=>e.IsParent?`    ${e==null?void 0:e.AreaName}`:`${e==null?void 0:e.AreaName}`,isOptionEqualToValue:(e,r)=>(e==null?void 0:e.AreaID)===(r==null?void 0:r.AreaID),renderInput:e=>a.jsx(v,{...e})})]}),a.jsxs(n,{md:6,children:[a.jsxs(l,{htmlFor:"AreaCodeInput",className:"col-form-label fw-bolder",children:["AreaCode",a.jsx("span",{style:{color:"red",fontWeight:"bold"},children:"*"})]}),a.jsx(c,{type:"text",id:"AreaCodeInput",name:"AreaCode",required:!0,value:t.AreaCode,onChange:o})]}),a.jsxs(n,{xs:6,children:[a.jsxs(l,{htmlFor:"AreaNameInput",className:"col-form-label fw-bolder",children:["AreaName",a.jsx("span",{style:{color:"red",fontWeight:"bold"},children:"*"})]}),a.jsx(c,{type:"text",id:"AreaNameInput",name:"AreaName",value:t.AreaName,onChange:o,required:!0})]}),a.jsxs(n,{xs:6,children:[a.jsxs(l,{htmlFor:"NumberPositionInput",className:"col-form-label fw-bolder",children:["NumberPosition",a.jsx("span",{style:{color:"red",fontWeight:"bold"},children:"*"})]}),a.jsx(c,{type:"number",id:"NumberPositionInput",name:"NumberPosition",value:t.NumberPosition,onChange:o,required:!0})]}),a.jsxs(n,{xs:6,children:[a.jsx(l,{htmlFor:"DescriptionInput",className:"col-form-label fw-bolder",children:"Description"}),a.jsx(c,{type:"text",id:"DescriptionInput",name:"Description",value:t.Description,onChange:o})]}),a.jsxs(n,{xs:6,children:[a.jsx(l,{htmlFor:"BayTypeIDInput",className:"col-form-label fw-bolder",children:"BayTypeID"}),a.jsx(S,{type:"number",id:"BayTypeIDInput",name:"BayTypeID",onChange:o,value:t.BayTypeID,options:[{label:"",value:-1},...L.map(e=>({label:e.BayTypeName,value:e.BayTypeID}))],required:!0})]}),a.jsxs(n,{md:6,children:[a.jsxs(l,{htmlFor:"statusInput",className:"col-form-label fw-bolder",children:["Status",a.jsx("span",{style:{color:"red",fontWeight:"bold"},children:"*"})]}),a.jsx(S,{type:"text",id:"statusInput",name:"StatusID",onChange:o,value:t.StatusID,options:[{label:"True",value:1},{label:"False",value:0}],required:!0})]}),a.jsx("div",{className:"d-flex justify-content-center",children:a.jsx(H,{style:{width:"fit-content",marginTop:"30px"},color:"primary",type:"submit",children:t.IsEdit?"Update area":"Create area"})})]})})]})};export{le as default};
